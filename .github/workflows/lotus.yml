name: Build Lotus Firmware

on:
  push:
    branches:
    - master
    - develop
    - lotus

jobs:
  lotus-build:
    runs-on: ubuntu-latest

    container: qmkfm/qmk_cli

    steps:
    - uses: actions/checkout@v3
      with:
        submodules: recursive

    - name: Install dependencies
      run: pip3 install -r requirements-dev.txt

    - name: Lint lotus
      run: |
        qmk lint -kb lotus/ansi -km default
        qmk lint -kb lotus/iso -km default
        qmk lint -kb lotus/jis -km default
        qmk lint -kb lotus/numpad -km default
        qmk lint -kb lotus/gridpad -km default

    - name: Build Lotus ANSI variant
      run: qmk compile -kb lotus/ansi -km default

    - name: Build Lotus ISO variant
      run: qmk compile -kb lotus/iso -km default

    - name: Build Lotus JIS variant
      run: qmk compile -kb lotus/jis -km default

    - name: Build Lotus Numpad
      run: qmk compile -kb lotus/numpad -km default

    - name: Build Lotus Gridpad
      run: qmk compile -kb lotus/gridpad -km default

    - uses: actions/upload-artifact@v3
      with:
        name: lotus_kb_qmk.${{github.sha}}
        path: |
          lotus_*.uf2

#  tests:
#    runs-on: ubuntu-latest
#
#    container: qmkfm/qmk_cli
#
#    steps:
#    - uses: actions/checkout@v3
#      with:
#        submodules: recursive
#
#    - name: Install dependencies
#      run: pip3 install -r requirements-dev.txt
#
#    - name: Run tests
#      run: make test:all
